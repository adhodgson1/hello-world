#addin "Cake.Docker"

//////////////////////////////////////////////////////////////////////
// ARGUMENTS
//////////////////////////////////////////////////////////////////////

var target = Argument("target", "Default");
var configuration = Argument("configuration", "Release");
var projectFilePaths = GetFiles("./*.csproj");
var nuGetPackSettings = new NuGetPackSettings
{   
  BasePath = Directory("./bin") + Directory(configuration),
  ArgumentCustomization = args => args.Append("-Prop Configuration=" + configuration)
};

//////////////////////////////////////////////////////////////////////
// PREPARATION
//////////////////////////////////////////////////////////////////////

// Define directories.
var buildDir = Directory("./bin") + Directory(configuration);

//////////////////////////////////////////////////////////////////////
// TASKS
//////////////////////////////////////////////////////////////////////

Task("Build")
    .Does(() =>
{
    MSBuild("./Hello-World.sln", settings =>
      settings.SetConfiguration(configuration));
});

Task("NuGetPack")
    .IsDependentOn("Build")
    .Does(() =>
{
      NuGetPack(projectFilePaths, nuGetPackSettings);
});

Task("DockerBuild")
    .IsDependentOn("NuGetPack")
    .Does(() =>
{
      DockerBuild (path=".");
});

//////////////////////////////////////////////////////////////////////
// TASK TARGETS
//////////////////////////////////////////////////////////////////////

Task("Default")
    .IsDependentOn("DockerBuild");

//////////////////////////////////////////////////////////////////////
// EXECUTION
//////////////////////////////////////////////////////////////////////

RunTarget(target);
